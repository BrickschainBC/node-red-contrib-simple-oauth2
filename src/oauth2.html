<!-- the main node definition that is registered with the editor -->
<script type="text/javascript">
    RED.nodes.registerType('oauth2-credentials', {
        category: 'config',
        defaults: {
            accountName: {value:"", required: true},
            clientId: {value:"", required: true},
            clientSecret: {value:"", required: true}
        },
        label: function() {
            return this.accountName;
        },
        exportable: false,
        oneditprepare: function() {
            var configNodeId = this.id;
            function showTwitterAuthStart() {
                var pathname = document.location.pathname;
                if (pathname.slice(-1) != "/") {
                    pathname += "/";
                }
                var callback = encodeURIComponent(location.protocol+"//"+location.hostname+":"+location.port+pathname+"oauth2-credentials/"+configNodeId+"/auth/callback");
                $("#node-config-dialog-ok").button("disable");
                $("#node-config-oauth-row").html('<div style="text-align: center; margin-top: 20px; "><a class="editor-button" id="node-config-oauth-start" href="oauth-credentials/'+configNodeId+'/auth?callback='+callback+'" target="_blank">'+clickhere+'</a></div>');
            }
        }
    });

    RED.nodes.registerType('oauth2', {
        category: 'function',
        color: '#a6bbcf',
        defaults: {
            account: {value: "", type: "oauth2-credentials", required: true},
            name: {value: ""},
            tokenHost: {value: "", required: true}
        },
        inputs:1,
        outputs:1,
        icon: "oauth-2-sm.png",
        label: function() {
            return this.name||"oauth2";
        }
    });
</script>

<!-- the edit template -->
<script type="text/x-red" data-template-name="oauth2-credentials">
    <div class="form-row">
        <label for="node-config-input-accountName"><i class="fa fa-user"></i> Account Name</label>
        <input type="text" id="node-config-input-accountName">
    </div>
    <div class="form-row">
        <label for="node-config-input-clientId"><i class="fa fa-user-circle"></i> Client ID</label>
        <input type="text" id="node-config-input-clientId">
    </div>
    <div class="form-row">
        <label for="node-config-input-clientSecret"><i class="fa fa-user-secret"></i> Client Secret</label>
        <input type="password" id="node-config-input-clientSecret" autocomplete="off">
    </div>
</script>
<script type="text/x-red" data-template-name="oauth2">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name">
    </div>
    <div class="form-row">
        <label for="node-input-account"><i class="fa fa-user"></i> Account</label>
        <input type="text" id="node-input-account">
    </div>
    <div class="form-row">
        <label for="node-input-tokenHost" title="URL without path where token requests are sent to."><i class="fa fa-external-link"></i> Token Host</label>
        <input type="text" id="node-input-tokenHost" placeholder="https://custom-service.org">
    </div>
</script>

<!-- the help text -->
<script type="text/x-red" data-help-name="oauth2">
    <p>An OAuth2 client which produces a valid access token as output.</p>
</script>
